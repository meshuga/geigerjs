(()=>{var e,t,o;const n="no device selected";var a=n;const c=e=>{a=e,document.getElementById("device").textContent=a};setInterval((function(){navigator.geolocation.getCurrentPosition((function(e){t=e.coords.latitude,o=e.coords.longitude}))}),1e3);var i=[];const r={rowData:i,columnDefs:[{field:"datetime",flex:2,headerName:"Date & time",valueFormatter:e=>e.value.toUTCString()},{field:"measurementValue",flex:1,headerName:"Measurement value"},{field:"measurementType",flex:1,headerName:"Measurement type"},{field:"latitude",flex:1},{field:"longitude",flex:1}]},s=document.querySelector("#myGrid"),l=agGrid.createGrid(s,r);function u(e){let n=e.target.value,a=[];for(let e=0;e<n.byteLength;e++)a.push("0x"+("00"+n.getUint8(e).toString(16)).slice(-2));if(15==a.length){let e="";switch(a[13]){case"0x01":e="uSv";break;case"0x04":e="SV/h";break;case"0x05":e="mR/h";break;case"0x06":e="CPS";break;case"0x07":e="CPM";break;case"0x08":e="impulse";break;case"0x09":e="impulse (timer on)"}let n=1;switch(a[12]){case"0x01":n=10;break;case"0x02":n=100;break;case"0x03":n=1e3}const c=parseInt(a[10].slice(2)+a[9].slice(2),10)/n;i.unshift({datetime:new Date,measurementValue:c,measurementType:e,latitude:t,longitude:o}),l.setGridOption("rowData",i),console.log("Current measurement: "+c+" - "+a.join(", "))}else console.log(a.length+" - "+a.join(", "))}c(n),document.getElementById("start").onclick=t=>{console.log("Requesting Bluetooth Device..."),navigator.bluetooth.requestDevice({filters:[{services:["0000fff0-0000-1000-8000-00805f9b34fb"]}]}).then((e=>(c(e.name),console.log("Connecting to GATT Server..."),e.gatt.connect()))).then((e=>(console.log("Getting Service..."),e.getPrimaryService(65520)))).then((e=>(console.log("Getting Characteristic..."),e.getCharacteristic(65522)))).then((t=>(e=t).startNotifications().then((t=>{console.log("> Notifications started"),e.addEventListener("characteristicvaluechanged",u)})))).catch((e=>{console.error(e)}))},document.getElementById("stop").onclick=t=>{e&&(e.stopNotifications().then((t=>{console.log("> Notifications stopped"),e.removeEventListener("characteristicvaluechanged",u)})).catch((e=>{console.log("Argh! "+e)})),c(n))},document.getElementById("export").onclick=e=>{l.exportDataAsCsv({fileName:"measurements-"+a+"-"+(new Date).toISOString()+".csv",columnSeparator:";"})}})();